#!/usr/bin/env python3
"""Lightweight Codex CLI stub for local development.

This script emulates the minimal surface area the backend expects by reading the
spec file and echoing a short status update before exiting successfully.
"""

from __future__ import annotations

import argparse
import json
from pathlib import Path
import sys
import time


def parse_args() -> argparse.Namespace:
    parser = argparse.ArgumentParser(prog="codex")
    parser.add_argument("--spec", required=True, help="Path to the development spec JSON file.")
    parser.add_argument(
        "--non-interactive",
        action="store_true",
        help="Ignored flag kept for interface compatibility.",
    )
    args, _ = parser.parse_known_args()
    return args


def main() -> int:
    args = parse_args()
    spec_path = Path(args.spec)
    if not spec_path.exists():
        print(f"[codex-stub] Spec file not found at {spec_path}", flush=True)
        return 0

    try:
        payload = json.loads(spec_path.read_text(encoding="utf-8"))
    except json.JSONDecodeError as exc:
        print(f"[codex-stub] Failed to parse spec JSON: {exc}", flush=True)
        return 0

    summary = payload.get("summary") or payload.get("title") or "unspecified request"
    print(f"[codex-stub] Applying development spec for: {summary}", flush=True)
    time.sleep(0.5)
    print("[codex-stub] No-op apply completed. No file changes were made.", flush=True)
    return 0


if __name__ == "__main__":
    sys.exit(main())
